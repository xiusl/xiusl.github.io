---
title: 大数据架构设计
date: 2024-10-16 21:52:58
categories: architecture exam
tags: 
- lambda
- kappa
- Hadoop
---


大数据带来的三大挑战
- 如何利用信息技术等手段处理非结构化和半结构化数据
- 如何探索大数据复杂性、不确定性特征描述的刻画方法及大数据的系统建模
- 数据异构性与决策异构性的关系对大数据知识发现与管理决策的影响

<!-- more -->


大数据处理系统架构特征
  1.鲁棒性和容错性
  2.低延迟读取和更新能力
  3.横向扩容
  4.通用性
  5.延展性
  6.即席查询能力
  7.最少维护能力
  8.可调试性

### Lambda 架构

- 设计目的在于提供一个能满足大数据系统关键特性的架构，包括高容错、低延迟、可扩展
- 整合**离线计算**与**实时计算**，融合不可变性、读写分离和复杂性隔离等原则
- 是用于同时处理离线数据和实时数据的、可容错的、可扩展的分布式系统
- 具备强鲁棒性，提供低延迟和持续更新
- 应用场景：机器学习、物联网、流处理
- 架构可分解为三层：批处理层、加速层、服务层

![Lambda 架构](//img-uss.likehub.top/uPic/2024-10-17/M3uGWL-WX20241017-092846@2x.png)

- 批处理层（Batch Layer）：
  存储数据集，在数据集上预先计算查询函数，并后见查询对应的View
  可以很好处理离线数据
  根据全体离线数据直接得到 Batch View
- 加速层（Speed Layer）：
  处理的是最近增量数据流，
  为了效率，在接受到新的数据后会不断更新 Real-tiem View
- 服务层（Serving Layer）：
  合并Batch View 和 Real-time View 中的结果数据集到最终数据集，用于响应用户的查询请求

在这种Lambda 架构中
- Hadoop (HDFS) 用于存储主数据集
- Spark（或Storm) 可构成速度层
- HBase（或Cassandra) 作为服务层，由Hive创建可查询的视图

Hadoop 是适合运行在通用硬件上的分布式文件系统。HDFS 是一个具有高度容错性的系统，能够提供高吞吐量的数据访问，非常适合大规模数据集上的应用
Apache Spark 是专为大规模数据处理而设计的快速通用的计算引擎，中间数据结果可以保存在内存，能更好的适用于数据挖掘与机器学习等需要迭代的 Map Reduce 算法
HBase-Hadoop Database 是一个高可靠性、高性能、面向列、可伸缩的分布式存储系统，可在廉价PCServer上搭建起大规模结构化存储集群

Lambda 架构的优点：容错性好、查询灵活度高、易伸缩、易扩展
缺点：全场景覆盖带来的编码开销（需要同时维护一套实时计算和一套存量计算代码），针对具体场景重新离线训练一遍的益处不大，重新部署和迁移成本很高。


- 事件溯源（Event Sourcing）与 Lambda 架构
Event Sourcing 本质上是一种数据持久化的方式，其由三个核心观点构成
1）整个系统以事件为驱动，所有事物都由事件驱动来完成
2）事件是核心。系统的数据以事件为基础，事件要保存在某种存储上
3）业务数据只是一些由事件产生的视图，不一定要保存到数据库中
Lambda 中对数据集存储使用的概念月 Event Sourcing 中的思想完全一致，使用统一的数据模型对数据处理事件本身进行定义
发生错误的时候，能够通过模型找到错误发生的原因，对这一事件进行重新计算，恢复系统的正确状态，实现了容错性

- CQRS 与 Lambda 架构
CQRS 架构分离了对数据进行的读操作和写操作，将能够改变数据模型状态的命令与模型状态查询操作实现了分离，是领域驱动设计的一个架构模式，解决数据库报表的输出处理方式
Lambda 架构中，数据的修改通过批处理和流处理实现，通过写操作将数据转换成查询时所对应的View，对数据查询时是通过 View 直接得到结果，实际上是一种形式的读写分离



### Kappa 架构

在 Lambda 架构的基础上进行了优化，删除了 Batch Layer 的架构，将数据通道以消息队列进行替代
依旧以流处理为主，数据在数据湖面进行了存储，需要进行离线分析或再次计算时，将数据湖的数据再次经过消息队列重播一次
输入数据直接由实时层的实时数据处理引擎对源源不断的源数据进行处理

![Kappa 架构](//img-uss.likehub.top/uPic/2024-10-17/HZCMTI-qVyP49.jpg)

从使用场景上对比：
1）Kappa 不是 Lambda 的替代架构，而是其简化版本，Kappa 放弃了对批处理的支持，更擅长业务本身为增量数据写入场景的分析需求
2）Lambda 直接支持批处理，更适合对历史数据分析查询的场景

Kappa 架构的优点：将实时和离线代码统一起来
缺点：
1）消息中间件缓存数据量和回溯数据由性能瓶颈
2）遇到大量不同实时流进行关联时，非常依赖实时计算系统的能力，很可能因为数据流先后顺序问题，导致数据丢失
3）抛弃了离线计算更加稳定可靠的特点

**Kappa+ 架构**
流式数据处理架构，核心思想是让流计算框架直接读 HDFS 里的数据仓库数据，一并实现实时计算和历史数据 backfll 计算
将不同源的数据通过 Kafka 导入到 Hadoop 中，通过 HDFS 来存储中间数据，再通过 spark 对数据进行分析处理，最后交由上层业务查询

**混合分析系统的Kappa架构**
Lambda 和 Kappa 都有展示层的困难点，如何支持热点数据的查询分析，解决方案是在 Kappa 基础上衍生数据分析流程
基于 Kafka + Flink 构建 Kappa 流计算数据架构，针对 Kappa 分析能力不足，利用 Kafka 对接 ES 实时分析引擎，部分弥补其数据分析能力
但 ES 也只适合对合理数据量级的热点数据进行索引，无法覆盖所有批处理相关的分析需求，是 Kappa 和 lambda 的折中方案

**对比和选择**
1）业务需求与技术要求：
  业务对与 Hadoop、Spark、Strom 等关键技术由强制依赖选择 lambda
  处理数据偏好于流式计算，依赖 Flink 计算引擎，选择 Kappa
2）复杂度
  项目中频繁对算法模型参数进行修改，算法模型支持同时执行批处理和流式计算，系统用一份代码进行数据处理 Kappa
3）开放维护成本
  lambda 需要有一定程度的开发维护成本，包括了两套系统的开发、部署、测试、维护
  Kappa 只需要维护一套系统
4）历史数据处理能力
  频繁接触海量数据集进行分析，lambda
  始终使用小规模数据集，流处理系统完全可是使用，选择 Kappa

![对比图](//img-uss.likehub.top/uPic/2024-10-17/JHUfnH-sLRhXb.jpg)



































